{"componentChunkName":"component---src-templates-blog-post-js","path":"/machine-learning/Making-Core-Data-Functional/","result":{"data":{"site":{"siteMetadata":{"title":"syd-dev.com ","author":"[SHIDDARTA BAHADUR]","siteUrl":"https://syd-dev.com","comment":{"disqusShortName":"","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"6e4c2dc8-787d-508d-9ee9-43c15399e077","excerpt":"Using functional-programming, we aim to make thread-management task in CoreData easier by creating new containers. Thread safety Many operations in CoreData are wrapped in either an async perform blocks, or their synchronous counterpart  . Both referred as the perform blocks her‚Ä¶","html":"<blockquote>\n<p>Using functional-programming, we aim to make thread-management task in CoreData easier by creating new containers.</p>\n</blockquote>\n<h2 id=\"thread-safety\" style=\"position:relative;\"><a href=\"#thread-safety\" aria-label=\"thread safety permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Thread safety</h2>\n<p>Many operations in CoreData are wrapped in either an async perform blocks, or their synchronous counterpart <code class=\"language-text\">performAndWait</code> . Both referred as the perform blocks hereafter.</p>\n<p>For example, we look at how we might approach things to make an object ‚ÄúBaby‚Äù.</p>\n<p>P/S: Just not your normal way of making babiesü§™</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">makeBaby</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> context<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">let</span> baby <span class=\"token operator\">=</span> <span class=\"token function\">Baby</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">:</span> context<span class=\"token punctuation\">)</span>\n\tbaby<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>While this might be the most straightforward implementation, it is not thread safe. So to protect against bad callers, we need to wrap our code in a <code class=\"language-text\">performAndWait</code> block.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">makeBaby</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> context<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Baby</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">var</span> baby<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Baby</span>\n\tcontext<span class=\"token punctuation\">.</span>performAndWait <span class=\"token punctuation\">{</span>\n\t\tbaby <span class=\"token operator\">=</span> <span class=\"token function\">Baby</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">:</span> context<span class=\"token punctuation\">)</span>\n\t\tbaby<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> baby\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The drawback is callers need to always double-check the implementation to make sure it‚Äôs always truly thread safe even the documents promise. Having said that, you know what‚Äôs worse? Writing it in a closed source SDK your company is trying to sell!</p>\n<p>Another example:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">makeBabies</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> context<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">,</span> names<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">Baby</span><span class=\"token punctuation\">]</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">var</span> babies<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">Baby</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\tcontext<span class=\"token punctuation\">.</span>performAndWait <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">for</span> name <span class=\"token keyword\">in</span> names <span class=\"token punctuation\">{</span>\n\t\t\tbabies<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span><span class=\"token function\">makeBaby</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">:</span> context<span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> name<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> babies\n<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Although one way to go about it is enforcing strict coding guidelines, but I‚Äôm still looking for a more foolproof (and scaleable) solution. To fix this, we are going to ask for some favour from Functional Programming (FP).</p>\n<h2 id=\"inspired-by-functional-programming\" style=\"position:relative;\"><a href=\"#inspired-by-functional-programming\" aria-label=\"inspired by functional programming permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Inspired by Functional Programming</h2>\n<p>One key thing about FP is ‚Äì identifying the different code ‚Äúpatterns‚Äù we often come across and taking advantage of it by making abstractions around them. Here‚Äôs one pattern I noticed from my personal experience with many CoreData related APIs ‚Äì they usually like to take in a NSManagedObjectContext object before they could run their operations.</p>\n<p>So, this is what we can start with:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// Functional Programming in Core Data</span>\n<span class=\"token keyword\">struct</span> <span class=\"token builtin\">FunctionalDataOperation</span> \t<span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">let</span> operation<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The <code class=\"language-text\">operation</code> in the encapsulation above tells us that all it needs is a NSManagedObjectContext for doing its job of performing an operation. But there is one problem though: there‚Äôs no way to properly represent a fetch because it always return void. So, we revise it to the following:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Element</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> operation<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Element</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">init</span> <span class=\"token punctuation\">(</span><span class=\"token number\">_</span> operation<span class=\"token punctuation\">:</span> @escaping <span class=\"token punctuation\">(</span><span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Element</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span>operation <span class=\"token operator\">=</span> operation\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To make it more robust, we made operation a <code class=\"language-text\">private</code> attribute and thus forcing callers to trigger the operation closure through operate. Doing so could avoid it being called by other threads which might eventually result in threading issues.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">struct</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Element</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token keyword\">let</span> operation<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Element</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function\">operate</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> context<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Element</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">var</span> result<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Element</span><span class=\"token operator\">!</span>\n\t\tcontext<span class=\"token punctuation\">.</span>performAndWait <span class=\"token punctuation\">{</span>\n\t\t\tresult <span class=\"token operator\">=</span> <span class=\"token function\">operation</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> result\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Our current implementation will block the calling-thread and thus it is considered thread-safe. And of course, it‚Äôs definitely possible to do an async implementation too ‚Äì I will leave it as an exercise for you (hint, hint ‚Äì you might want to also consider taking in the running thread as a parameter too!).</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function\">operateAsync</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> context<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">,</span> <span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> @escaping <span class=\"token punctuation\">(</span><span class=\"token builtin\">Element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">{</span>\n\t\tcontext<span class=\"token punctuation\">.</span>perform <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">operation</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>What we now have:</p>\n<ul>\n<li>Our current makeBaby function returns a baby, when given a NSManagedObjectContext and its name.</li>\n</ul>\n<p>What we want:</p>\n<ul>\n<li>Applying FP technique to get an operation that creates and returns a baby in a specific NSManagedObjectContext.</li>\n</ul>\n<p>Re-implementing the old <code class=\"language-text\">makeBaby</code> from this:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">makeBaby</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span> context<span class=\"token punctuation\">:</span> <span class=\"token builtin\">NSManagedObjectContext</span><span class=\"token punctuation\">,</span> name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Baby</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">var</span> baby<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Baby</span><span class=\"token operator\">!</span>\n\tcontext<span class=\"token punctuation\">.</span>performAndWait <span class=\"token punctuation\">{</span>\n\t\tbaby <span class=\"token operator\">=</span> <span class=\"token function\">Baby</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">:</span>context<span class=\"token punctuation\">)</span>\n\t\tbaby<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> baby\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>To this:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">makeBabyOperation</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Baby</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// using type inference and trailing closure</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span> context <span class=\"token keyword\">in</span>\n\t\t<span class=\"token keyword\">let</span> baby <span class=\"token operator\">=</span> <span class=\"token function\">Baby</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">:</span>context<span class=\"token punctuation\">)</span>\n\t\tbaby<span class=\"token punctuation\">.</span>name <span class=\"token operator\">=</span> name\n\t\t<span class=\"token keyword\">return</span> baby\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Not much seems to have changed but you know what? Now we can just focus on writing the code and throw all the messy thread management to <code class=\"language-text\">FunctionalDataOperation</code>! The code now is much easier to maintain and succinct.</p>\n<p>Awesome, isn‚Äôt it?</p>\n<p>For context, we assume the code is running on the very same thread the Baby was created ‚Äì so that it won‚Äôt crash when accessing the properties.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> myBaby <span class=\"token operator\">=</span> <span class=\"token function\">makeBabyOperation</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">:</span> ‚Äù<span class=\"token builtin\">Bae</span>‚Äù<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>myBaby<span class=\"token punctuation\">.</span>name<span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// prints ‚ÄúBae‚Äù</span></code></pre></div>\n<p>Next up, we will re-implement the <code class=\"language-text\">makeBabies</code> function with <code class=\"language-text\">FunctionalDataOperation</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">makeBabiesOperation</span><span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">Baby</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span> context <span class=\"token keyword\">in</span>\n\t\t<span class=\"token keyword\">var</span> babies<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">Baby</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n\n\t\t<span class=\"token keyword\">for</span> name <span class=\"token keyword\">in</span> names <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">let</span> makeBaby <span class=\"token operator\">=</span> <span class=\"token function\">makeBabyOperation</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">:</span> name<span class=\"token punctuation\">)</span>\n\t\t\tbabies<span class=\"token punctuation\">.</span><span class=\"token function\">append</span><span class=\"token punctuation\">(</span>makeBaby<span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> babies\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Although now the API is considered thread safe, the function is still very much imperative and certainly can be more concise.</p>\n<h2 id=\"enhancing-with-fp-map\" style=\"position:relative;\"><a href=\"#enhancing-with-fp-map\" aria-label=\"enhancing with fp map permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enhancing with FP (Map)</h2>\n<p>Given a situation for a function to extract the name of a baby, there are 3 potential implementations that I could think of off the top of my head:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token comment\">// First approach</span>\n<span class=\"token comment\">// Normal implementation in CoreData - managing the threads.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">getNameFirst</span><span class=\"token punctuation\">(</span>of baby<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Baby</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">String</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">var</span> name<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token operator\">!</span>\n\tbaby<span class=\"token punctuation\">.</span>managedObjectContext<span class=\"token operator\">?</span><span class=\"token punctuation\">.</span>performAndWait <span class=\"token punctuation\">{</span>\n\t\tname <span class=\"token operator\">=</span> baby<span class=\"token punctuation\">.</span>name\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> name\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Implemented with FunctionalDataOperation;</span>\n<span class=\"token comment\">// But creating and running operation are in the same scope</span>\n<span class=\"token comment\">// not very scalable for more complex operation.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">getNameSecond</span><span class=\"token punctuation\">(</span>of baby<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Baby</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">String</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">let</span> operation <span class=\"token operator\">=</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">String</span><span class=\"token operator\">></span> <span class=\"token punctuation\">(</span> <span class=\"token number\">_</span> <span class=\"token keyword\">in</span>\n\t\t<span class=\"token keyword\">return</span> baby<span class=\"token punctuation\">.</span>name\n\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token keyword\">return</span> operation<span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>baby<span class=\"token punctuation\">.</span>managedObjectContext<span class=\"token operator\">!</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// Returns a FunctionalDataOperation</span>\n<span class=\"token comment\">// Can be used to compose larger opearations, but still not inituitive.</span>\n<span class=\"token keyword\">func</span> <span class=\"token function\">getNameThird</span><span class=\"token punctuation\">(</span>of baby<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Baby</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">String</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span> <span class=\"token number\">_</span> <span class=\"token keyword\">in</span>\n\t\t<span class=\"token keyword\">return</span> baby<span class=\"token punctuation\">.</span>name\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you notice, all the code above is basically just trying to achieve this:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">getBabyName</span><span class=\"token punctuation\">(</span>of baby<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Baby</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">String</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> baby<span class=\"token punctuation\">.</span>name\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Unfortunately, it is not thread safe. It has to be either first wrapped in a perform, or be converted into <code class=\"language-text\">FunctionalDataOperation</code>. Having said that, we will try solving it with <code class=\"language-text\">map</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token builtin\">map</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">NewElement</span><span class=\"token operator\">></span>\n\t<span class=\"token punctuation\">(</span> f<span class=\"token punctuation\">:</span> @escaping <span class=\"token punctuation\">(</span><span class=\"token builtin\">Element</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">NewElement</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">NewElement</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">NewElement</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> context <span class=\"token keyword\">in</span>\n\t\t\t<span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>One key thing in this new operation is that the transform function would always run on the correct context‚Äôs thread. This means that callers of <code class=\"language-text\">getBabyName</code> function no longer have to worry about threading issues.</p>\n<p>Here‚Äôs how we would have the baby-making operation with <code class=\"language-text\">getBabyName</code>‚Äôs transformation.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> makeBabyOperation<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Baby</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">makeBaby</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">:</span> ‚Äú<span class=\"token builtin\">Bae</span>‚Äù<span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">let</span> getBabyNameSafelyOperation<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">String</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span>\nmakeBabyOperation<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>getBabyName<span class=\"token punctuation\">)</span>\n<span class=\"token function\">print</span><span class=\"token punctuation\">(</span>getBabyNameSafelyOperation<span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// prints ‚ÄúBae‚Äù</span>\n<span class=\"token comment\">// Not removing type-signature to keep it beginner-friendly</span></code></pre></div>\n<p>A breakdown of our operation:</p>\n<ul>\n<li>First, we create an operation that makes a baby named ‚ÄúBae‚Äù.</li>\n<li>Then, we transform the result of the baby-operation into just its name with <code class=\"language-text\">getBabyName</code>.</li>\n<li>Finally, we ‚Äúoperate‚Äù the <code class=\"language-text\">FunctionalDataOperation</code> (on the right context) to get its name String.</li>\n</ul>\n<h2 id=\"flatmap\" style=\"position:relative;\"><a href=\"#flatmap\" aria-label=\"flatmap permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>FlatMap</h2>\n<p>Remember, not all functional programming containers have a <code class=\"language-text\">flatMap</code> operation. Having said that, here‚Äôs a flatMap implementation for our use-case:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> flatMap<span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> f<span class=\"token punctuation\">:</span> @escaping <span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> context <span class=\"token keyword\">in</span>\n\t\t\t<span class=\"token function\">f</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Then, we can start writing a convenience method that creates a <code class=\"language-text\">FunctionalDataOperation</code> (and saves the context). Please take note we‚Äôre using <code class=\"language-text\">try!</code> in current implementation, a more thorough error-handling will be covered in an upcoming article.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">static</span> <span class=\"token keyword\">func</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> context <span class=\"token keyword\">in</span>\n\t\t\t<span class=\"token keyword\">try</span><span class=\"token operator\">!</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>For instance, we need to make a baby and save the context. One way to start with is by looking at how we want the calling code to look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> makeBabyOperation<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">makeBaby</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">:</span> ‚Äú<span class=\"token builtin\">Bae</span>‚Äù<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>As we can see, calling <code class=\"language-text\">save()</code> at the end of FunctionalDataOperation chain doesn‚Äôt return any values. However, having access to the previous value can make things easier in certain situations, so we‚Äôll need to make a bit of changes to the code.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">let</span> makeBabyOperation<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Baby</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">makeBaby</span><span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">:</span> ‚Äú<span class=\"token builtin\">Bae</span>‚Äù<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>If we just look at the initial signature, the first implementation might look like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span> context <span class=\"token keyword\">in</span>\n\t\t\t<span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">try</span><span class=\"token operator\">!</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">return</span> result\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Although it does its job, the function is still very imperative. Since we already wrapped <code class=\"language-text\">try</code>! <code class=\"language-text\">context.save()</code> in a <code class=\"language-text\">FunctionalDataOperation</code>, perhaps we can use map to bring it up a notch?</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span> context <span class=\"token keyword\">in</span>\n\t\t\t<span class=\"token keyword\">let</span> aValue<span class=\"token punctuation\">:</span> A <span class=\"token operator\">=</span> <span class=\"token keyword\">self</span><span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span>\n\t\t\t<span class=\"token keyword\">let</span> saveAndReturn <span class=\"token operator\">=</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">map</span> <span class=\"token punctuation\">{</span> <span class=\"token number\">_</span> <span class=\"token keyword\">in</span> aValue <span class=\"token punctuation\">}</span>\n\t\t\t<span class=\"token keyword\">return</span> saveAndReturn<span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>First, we operate self to get an ‚ÄúA‚Äù value, then we run a save operation and transform its Void output into the A type return. We then call operate in order to return the raw result, instead of returning a <code class=\"language-text\">FunctionalDataOperation</code>.</p>\n<p>However, can we do better?</p>\n<p>Calling operateinside <code class=\"language-text\">FunctionalDataOperation</code> haven‚Äôt we seen this pattern before? It‚Äôs in the implementation of <code class=\"language-text\">map</code> and <code class=\"language-text\">flatMap</code>! So, we can just let them to do the operate call.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">func</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">return</span> flatMap <span class=\"token punctuation\">{</span> aValue <span class=\"token keyword\">in</span>\n\t\t\t<span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token builtin\">map</span> <span class=\"token punctuation\">{</span> <span class=\"token number\">_</span> <span class=\"token keyword\">in</span> aValue <span class=\"token punctuation\">}</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If you have read my previous article about <code class=\"language-text\">Result</code> type, this pattern should look familiar to you. Otherwise, you can try breaking down the process for easier digest.</p>\n<p>Now, we have implemented two very powerful functional programming operators. We can still make our <code class=\"language-text\">makeBaby</code> method even more succinct. But hang on! We need two more FP operators.</p>\n<h2 id=\"zip\" style=\"position:relative;\"><a href=\"#zip\" aria-label=\"zip permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Zip</h2>\n<p>This signature shouldn‚Äôt be too foreign if you are familiar with <code class=\"language-text\">zip</code> for Swift‚Äôs <code class=\"language-text\">Array</code>. The implementation is pretty trivial, all it does is creating a brand-new DataOperation that returns a tuple with aOp and bOp‚Äôs result.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> zip<span class=\"token operator\">&lt;</span>A<span class=\"token punctuation\">,</span> B<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> aOp<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span>A<span class=\"token operator\">></span><span class=\"token punctuation\">,</span> <span class=\"token number\">_</span> bOp<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span>\n<span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">,</span>B<span class=\"token punctuation\">)</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span> <span class=\"token punctuation\">{</span> context <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>aOp<span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">:</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bOp<span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">in</span><span class=\"token punctuation\">:</span> context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Zip is very useful when we have multiple things to fetch, and we could only do something after they both have returned.</p>\n<h2 id=\"traversable\" style=\"position:relative;\"><a href=\"#traversable\" aria-label=\"traversable permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Traversable</h2>\n<p>I have to admit that I am not very well-versed in Traversable, but from my experience I do know containers with this attribute have a <code class=\"language-text\">sequence</code> function that looks something like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> sequence<span class=\"token operator\">&lt;</span>A<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> ops<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span>A<span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span>A<span class=\"token punctuation\">]</span><span class=\"token operator\">></span></code></pre></div>\n<p>So <code class=\"language-text\">Array</code> is the container that is <code class=\"language-text\">traversable</code> here and sequence flips the Array container with <code class=\"language-text\">FunctionalDataOperation</code>. The implementation is rather straightforward.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> sequence<span class=\"token operator\">&lt;</span>A<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> ops<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span>A<span class=\"token operator\">></span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span>A<span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">return</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span>A<span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span> context <span class=\"token keyword\">in</span>\n\t\tops<span class=\"token punctuation\">.</span><span class=\"token builtin\">map</span> <span class=\"token punctuation\">{</span> $<span class=\"token number\">0</span><span class=\"token punctuation\">.</span><span class=\"token function\">operate</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let‚Äôs have a breakdown here:</p>\n<ul>\n<li>We first transform the array of <code class=\"language-text\">FunctionalDataOperation</code> into values of ‚ÄúA‚Äùs by ‚Äúoperating‚Äù them within the context.</li>\n<li>Then, wrapping the whole thing in another FunctionalDataOperation.</li>\n<li>With that, we can start cleaning up our clunky <code class=\"language-text\">makeBaby</code> function!</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">makeBabies</span><span class=\"token punctuation\">(</span>names<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">String</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">Baby</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">let</span> makeBabyOperation<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Baby</span><span class=\"token operator\">></span><span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> names<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span>makeBaby<span class=\"token punctuation\">)</span>\n\t<span class=\"token keyword\">let</span> makeBabiesOperation<span class=\"token punctuation\">:</span> <span class=\"token builtin\">FunctionalDataOperation</span><span class=\"token operator\">&lt;</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">Baby</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">sequence</span><span class=\"token punctuation\">(</span>makeBabyOperation<span class=\"token punctuation\">)</span>\n\n\t<span class=\"token keyword\">return</span> makeBabiesOperation\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>And‚Ä¶that‚Äôs all! We have successfully transformed the array of names into an array of baby-making operations, then we use <code class=\"language-text\">sequence</code> to flip the containers so that the function only needs to return one <code class=\"language-text\">FunctionalDataOperation</code>.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>In this article, we learnt about ‚Äúmaking babies‚Äù the safe way by introducing the concept of container (i.e. FunctionalDataOperation) in functional programming. And, having implemented functional operators like map, flapMapand and zip, we are now better equipped to build complex functionalities much more concisely.</p>\n<h2 id=\"up-next\" style=\"position:relative;\"><a href=\"#up-next\" aria-label=\"up next permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Up next</h2>\n<p>As you might remember, try! was used in this article. Hence, we will need to address the lack of a proper error handling in our baby-making process. This is so that the code can be more robust.</p>\n<p>Feel free to share your thoughts with me! Thanksüòä</p>","frontmatter":{"title":"Making Core Data Functional","date":"25/04/2021","showToc":true}}},"pageContext":{"slug":"/machine-learning/Making-Core-Data-Functional/","previous":{"fields":{"slug":"/API/(RE)Designing-Objective-C-APIs-in-Swift/"},"frontmatter":{"title":"(RE)Designing Objective-C APIs in Swift","category":"API","draft":false,"showToc":true}},"next":{"fields":{"slug":"/machine-learning/Error-Handling-in-Functional-Data-Operation/"},"frontmatter":{"title":"Error Handling in Functional Data Operation","category":"iOS","draft":false,"showToc":true}}}},"staticQueryHashes":["3128451518","4154702432"]}