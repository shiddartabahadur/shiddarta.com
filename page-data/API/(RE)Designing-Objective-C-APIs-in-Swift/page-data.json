{"componentChunkName":"component---src-templates-blog-post-js","path":"/API/(RE)Designing-Objective-C-APIs-in-Swift/","result":{"data":{"site":{"siteMetadata":{"title":"syd-dev.com ","author":"[SHIDDARTA BAHADUR]","siteUrl":"https://syd-dev.com","comment":{"disqusShortName":"","utterances":""},"sponsor":{"buyMeACoffeeId":""}}},"markdownRemark":{"id":"1dfa5a75-1271-5ae6-997d-c74d85b84810","excerpt":"This is about the creation of Result type in Swift 5 standard library – and how each of its methods is derived and implemented. Introduction Swift’s very first error handling  (i.e. try-throw-catch), was first introduced in Swift 2.0 to allow developers to propagate errors irres…","html":"<blockquote>\n<p>This is about the creation of Result type in Swift 5 standard library – and how each of its methods is derived and implemented.</p>\n</blockquote>\n<h2 id=\"introduction\" style=\"position:relative;\"><a href=\"#introduction\" aria-label=\"introduction permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Introduction</h2>\n<p>Swift’s very first error handling <code class=\"language-text\">API</code> (i.e. try-throw-catch), was first introduced in Swift 2.0 to allow developers to propagate errors irrespective of the return type. We will re-implement Result from ground-up to understand its design rationale. Many asynchronous APIs in Objective-C handles returned result by accepting two parameters in their completion-handlers: one that handles successful <code class=\"language-text\">API</code> operation, and another to handle if it fails. However, there is a major flaw and it’s especially more evident when we are going re-write it into Swift.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">failableAPI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">try</span> <span class=\"token function\">failableAPI</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">print</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">.</span>localizedDescription<span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>However, there is no way for an async function to throw an <code class=\"language-text\">error</code> to its callback closure (the completionHandler). A common workaround is to pass the error into the callback.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Data</span><span class=\"token operator\">?</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">Error</span><span class=\"token operator\">?</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    anotherAsyncAPI <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> error <span class=\"token keyword\">in</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">,</span> error<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Unfortunately, if we want to have a 100% robust API, our completion block needs to handle all 4 possible code paths:</p>\n<ul>\n<li>Both <code class=\"language-text\">data</code> and error <code class=\"language-text\">exist</code> (not nil)</li>\n<li>Only <code class=\"language-text\">error</code> exists</li>\n<li>Only <code class=\"language-text\">data</code> exists</li>\n<li>Both <code class=\"language-text\">data</code> not exist (nil)</li>\n</ul>\n<p>Logically, the API can only have either one of the two outcomes: 2 and 3. However, there is nothing to prevent the codepath of 1 and 4.</p>\n<h2 id=\"swifts-type-system\" style=\"position:relative;\"><a href=\"#swifts-type-system\" aria-label=\"swifts type system permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Swift’s type system</h2>\n<p><code class=\"language-text\">Result</code> type has been introduced in Swift 5, but in order for us to understand better, we will be re-implementing it step-by-step to understand the design rationale.</p>\n<p>The fact that only case 2 and 3 could happen means:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">enum</span> <span class=\"token builtin\">Result</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Data</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">case</span> <span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Error</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>If we re-implement our <code class=\"language-text\">load</code> function using our <code class=\"language-text\">Result</code> type:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    anotherAsyncAPI <span class=\"token punctuation\">{</span> data<span class=\"token punctuation\">,</span> error <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> data <span class=\"token operator\">=</span> data <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token keyword\">let</span> error <span class=\"token operator\">=</span> error <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token function\">fatalError</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Logically impossible codepath.\"</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>The advantage of such an implementation is if we forget to handle the error, the Swift compiler will scream at us for ignoring an enum case. So by this point, it is evident that this is better than the (Data?, Error?).</p>\n<p>To make code reusable, we can just ‘adapt’ the enum to handle different data types by simply using <a target=\"_blank\" href=\"https://docs.swift.org/swift-book/LanguageGuide/Generics.html\">Generics.</a></p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">enum</span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>T<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">case</span> <span class=\"token function\">success</span><span class=\"token punctuation\">(</span>T<span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">case</span> <span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Error</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Instead of constraining only Data-type in the success case, it’s now a generic type T. So then, our Result type would no longer be limited to our specific load function.</p>\n<p>In case if you want, we can also make Error parameter to confine to a protocol to enforce more fine-grained error handling. But it isn’t required.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">load</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Data</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Ok, so let’s explore deeper with these two slightly more complicated functions:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadString</span><span class=\"token punctuation\">(</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">String</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> dateString <span class=\"token operator\">=</span> <span class=\"token string\">\"2019-0221T11:24:00+0000\"</span>\n    <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>dateString<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">func</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from string<span class=\"token punctuation\">:</span> <span class=\"token builtin\">String</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Date</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">let</span> dateFormatter <span class=\"token operator\">=</span> <span class=\"token function\">DateFormatter</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    dateFormatter<span class=\"token punctuation\">.</span>dateFormat <span class=\"token operator\">=</span> <span class=\"token string\">\"yyyy-MM-dd'T'HH:mm:ssZ\"</span>\n    dateFormatter<span class=\"token punctuation\">.</span>locale <span class=\"token operator\">=</span> <span class=\"token function\">Locale</span><span class=\"token punctuation\">(</span>identifier<span class=\"token punctuation\">:</span> <span class=\"token string\">\"en_US_POSIX\"</span><span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">guard</span> <span class=\"token keyword\">let</span> date <span class=\"token operator\">=</span> dateFormatter<span class=\"token punctuation\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span>string<span class=\"token punctuation\">)</span>\n\n    <span class=\"token keyword\">else</span> <span class=\"token punctuation\">{</span> <span class=\"token keyword\">throw</span> <span class=\"token builtin\">OperationError</span><span class=\"token punctuation\">.</span>invalidDateString <span class=\"token punctuation\">}</span>\n    <span class=\"token keyword\">return</span> date\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">loadString</code> takes a callback and mocks as an async call to pass back a Result. For simplicity, it’s set to always pass the same string, but of course, we can make it to pass failure too.</p>\n<p>Also date(from:) function takes in a string and tries to return a Date. If it fails, it will throw an error, it’s up to the caller how it will be handled. To make things easier, we’ll just have a generic OperationError.invalidDateString error.</p>\n<p>We will then create an artificial async function that loads a date “asynchronously” – loading the date string from the loadString function and using the date( from: ) function to parse our date string.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadString <span class=\"token punctuation\">{</span> stringResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">switch</span> stringResult <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">let</span> d <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">)</span>\n                <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>d<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>In the success-branch of the switch statement, we use <code class=\"language-text\">try</code> to call some throwing function, and transforming its return value (or error) into the expected Result for the callback. We can generalise that.</p>\n<p>It seems like the do-catch block is agnostic of the throwing function inside the do-closure. All it cares about is transforming its return value (or thrown error) into a Result. But since we are going to be creating a Result, why not just abstract it by making it an initialiser?</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">Result</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">init</span> <span class=\"token punctuation\">(</span>catching body<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> A<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">do</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">let</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">try</span> <span class=\"token function\">body</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token keyword\">self</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span> <span class=\"token keyword\">catch</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">self</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>So this initialiser accepts a throwing closure that transforms its result into our Result type. Using this in our loadDate function:</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadString<span class=\"token punctuation\">{</span> stringResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">switch</span> stringResult <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> string<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">try</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Nice! It totally got rid of the do-catch code. Let’s leave it for now.</p>\n<h2 id=\"enhancing-result-type\" style=\"position:relative;\"><a href=\"#enhancing-result-type\" aria-label=\"enhancing result type permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Enhancing Result Type</h2>\n<p>Now that we have a loadDate function, what if we want to create an async function that gets the month of that date? We have to include loadDate in our implementation. Of course, we are given a helper function to extract the month from a given date. Month is an enum with twelve values for each month.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span>of date<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Date</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Month</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">switch</span> <span class=\"token builtin\">Calendar</span><span class=\"token punctuation\">.</span>current<span class=\"token punctuation\">.</span><span class=\"token function\">component</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span>month<span class=\"token punctuation\">,</span> from<span class=\"token punctuation\">:</span>date<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token number\">1</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>jan\n        <span class=\"token keyword\">case</span> <span class=\"token number\">2</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>feb\n        <span class=\"token keyword\">case</span> <span class=\"token number\">3</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>mar\n        <span class=\"token keyword\">case</span> <span class=\"token number\">4</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>apr\n        <span class=\"token keyword\">case</span> <span class=\"token number\">5</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>may\n        <span class=\"token keyword\">case</span> <span class=\"token number\">6</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>jun\n        <span class=\"token keyword\">case</span> <span class=\"token number\">7</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>jul\n        <span class=\"token keyword\">case</span> <span class=\"token number\">8</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>aug\n        <span class=\"token keyword\">case</span> <span class=\"token number\">9</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>sep\n        <span class=\"token keyword\">case</span> <span class=\"token number\">10</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>oct\n        <span class=\"token keyword\">case</span> <span class=\"token number\">11</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>nov\n        <span class=\"token keyword\">case</span> <span class=\"token number\">12</span><span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span>dec\n        <span class=\"token keyword\">default</span><span class=\"token punctuation\">:</span> <span class=\"token function\">fatalError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Let’s start with the signature for loadMonth. The first question to ask is do we need a Result? Or can we just pass back the Int because getMonth never fails?</p>\n<p>The answer is yes, we need it because loadDate can fail, so we have to be able to propagate that error. The first pass of the whole function is this.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadMonth</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Month</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadDate <span class=\"token punctuation\">{</span> dateResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">switch</span> dateResult <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> date<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> <span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span>of<span class=\"token punctuation\">:</span> date<span class=\"token punctuation\">)</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Note that I have named the variable in the success branch a generic name “value” intentionally.</p>\n<p>Now let’s write a <code class=\"language-text\">loadNumberOfDays</code> function that gets how many days are in the month that we got. We are also provided with the following method on Month.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">Month</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">//ignoring leap years</span>\n    <span class=\"token keyword\">func</span> <span class=\"token function\">numberOfDays</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Int</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token keyword\">self</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>jan<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">31</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>feb<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">28</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>mar<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">31</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>apr<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">30</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>may<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">31</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>jun<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">30</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>jul<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">31</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>aug<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">31</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>sep<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">30</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>oct<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">31</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>nov<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">30</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span>dec<span class=\"token punctuation\">:</span> <span class=\"token keyword\">return</span> <span class=\"token number\">31</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">loadNumberOfDays</code> should be very similar to the functions we created before, its implementation looks like this.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadNumberOfDays</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Int</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadMonth <span class=\"token punctuation\">{</span> monthResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">switch</span> monthResult <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> month<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">let</span> value <span class=\"token operator\">=</span> month<span class=\"token punctuation\">.</span><span class=\"token function\">numberOfDays</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Hang on! It looks suspiciously similar to <code class=\"language-text\">loadMonth</code>! The methods only differ on one line. This must be a pattern we can generalise.</p>\n<p>Indeed, when we look closely, the implementations of our async functions are just turning some Result into another Result. For example, <code class=\"language-text\">loadMonth</code> is taking a Result<Date> and turning it into Result<Month>; loadNumberOfDays turns Result<Month> into Result<Int>.</p>\n<p>When we focus on <code class=\"language-text\">loadMonth</code>, we can even notice that the implementation details are all in <code class=\"language-text\">getMonth(of:)</code>. This can be seen as taking a function <code class=\"language-text\">getMonth(of:)</code> that goes from (Date) -> Month to (Result<Date>) -> Result<Month>. It somehow “lifted” that function into the Result world.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token builtin\">map</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Date</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Month</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Month</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span>\n<span class=\"token comment\">// can think of it as \"lifting\"</span></code></pre></div>\n<p>If you don’t recognise this yet, let us replace <code class=\"language-text\">Result</code> with <code class=\"language-text\">Array</code>, using the natural syntax.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token builtin\">map</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Date</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Month</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span><span class=\"token builtin\">Date</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">[</span><span class=\"token builtin\">Month</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Given a function that knows how to transform <code class=\"language-text\">Date</code> into <code class=\"language-text\">Month</code>. It’s able to return a function that knows how to transform an array of <code class=\"language-text\">Month</code>. Are you able to recognise this higher-order function?</p>\n<p>Yes, it’s Map! Usually, we call it as a method on an array, but that signature is not as clear as the one above, which is more symmetric. So let’s implement the map function for <code class=\"language-text\">Result</code> shall we? We are going to implement the method version.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">Result</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token builtin\">map</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> f<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> B<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token keyword\">self</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token function\">f</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>As we can see, the code in <code class=\"language-text\">loadMonth</code> and <code class=\"language-text\">loadNumberOfDays</code> are very similar.</p>\n<p>Let’s rewrite <code class=\"language-text\">loadMonth</code> using our new map method.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadMonth</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Month</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadDate <span class=\"token punctuation\">{</span> dateResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> monthResult <span class=\"token operator\">=</span> dateResult<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span>of<span class=\"token punctuation\">:</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>monthResult<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It has become so short! This is amazing. Let’s try doing it with <code class=\"language-text\">loadNumberOfDays</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadNumberOfDays</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Int</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadMonth <span class=\"token punctuation\">{</span> monthResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> daysResult <span class=\"token operator\">=</span> monthResult<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Month</span><span class=\"token punctuation\">.</span>numberOfDays<span class=\"token punctuation\">)</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>daysResult<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">Month.numberOfDays</code> might look strange to you. But swift actually provides a static version of all instance methods. Unfortunately, the above code doesn’t compile, because of <code class=\"language-text\">Month.numberOfDays</code> signature.</p>\n<p>//Month.numberOfDays: (Month) -> (() -> Int)</p>\n<p>There are many ways to get rid of the empty tuple, but let’s go around it for now by calling the method directly.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadNumberOfDays</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Int</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadMonth <span class=\"token punctuation\">{</span> monthResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> daysResult <span class=\"token operator\">=</span> monthResult<span class=\"token punctuation\">.</span><span class=\"token builtin\">map</span> <span class=\"token punctuation\">{</span> $<span class=\"token number\">0</span><span class=\"token punctuation\">.</span><span class=\"token function\">numberOfDays</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>daysResult<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Now you might feel like there are more things that we can generalise because both of them are calling the callback in another function’s callback. You are right. But we won’t do it today, we don’t have enough tools yet.</p>\n<h2 id=\"using-map\" style=\"position:relative;\"><a href=\"#using-map\" aria-label=\"using map permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Using map</h2>\n<p>There is one more function that can benefit from <code class=\"language-text\">map</code> surely, it’s <code class=\"language-text\">loadDate</code>. Let’s try to rewrite it using map.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadString <span class=\"token punctuation\">{</span> stringResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> dateResult <span class=\"token operator\">=</span> stringResult<span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">fatalError</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Here, we run into our first problem, date(from:) is a throwing function, so we can’t just pass it into <code class=\"language-text\">map</code>. You might want to make <code class=\"language-text\">map</code> have the ability to receive a throwing function. But then you would be mixing up two different error handling solutions, which is not ideal. There should be a better way.</p>\n<p>Before finding the final solution, let’s just try to hack it together first.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadString <span class=\"token punctuation\">{</span> stringResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> dateResult <span class=\"token operator\">=</span> stringResult<span class=\"token punctuation\">.</span><span class=\"token builtin\">map</span> <span class=\"token punctuation\">{</span> string <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">return</span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">try</span> <span class=\"token function\">Date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span> string<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>dateResult<span class=\"token punctuation\">)</span> <span class=\"token comment\">// dateResult is type Result&lt;Result&lt;Date>></span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"nested-result\" style=\"position:relative;\"><a href=\"#nested-result\" aria-label=\"nested result permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Nested Result</h2>\n<p>Here’s to our second problem. We need to return a Result in the <code class=\"language-text\">map</code> because <code class=\"language-text\">date(from:)</code> is a throwing function, but this has created a nested <code class=\"language-text\">Result</code>. So we can’t feed it elegantly into the callback closure.</p>\n<p>The first solution might look something like this</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    loadString <span class=\"token punctuation\">{</span> stringResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> dateResult <span class=\"token operator\">=</span> stringResult<span class=\"token punctuation\">.</span><span class=\"token builtin\">map</span> <span class=\"token punctuation\">{</span> string <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">return</span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">try</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span>string<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token keyword\">switch</span> dateResult <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> innerDateResult<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>innerDateResult<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>While it works, we can make it better. In fact, this pattern has come up so much that people are calling it flatMap.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\">flatMap<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>A<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>flatMap is similar to map. They are both higher-order functions. It’s able to lift a function that can fail, into the world of Result. Let’s implement it as a method on Result.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">Result</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> flatMap<span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> f<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span>  <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">let</span> nestedResult<span class=\"token punctuation\">:</span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span><span class=\"token operator\">></span> <span class=\"token operator\">=</span> <span class=\"token function\">map</span><span class=\"token punctuation\">(</span>f<span class=\"token punctuation\">)</span>\n        <span class=\"token keyword\">switch</span> nestedResult <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> result<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> result\n        <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n            <span class=\"token keyword\">return</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span>e<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It’s straightforward to integrate it into loadDate.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadString <span class=\"token punctuation\">{</span> stringResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> dateResult <span class=\"token operator\">=</span> stringResult<span class=\"token punctuation\">.</span>flatMap <span class=\"token punctuation\">{</span> string <span class=\"token keyword\">in</span>\n            <span class=\"token keyword\">return</span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n                <span class=\"token keyword\">try</span> <span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span>string<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>dateResult<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"catching\" style=\"position:relative;\"><a href=\"#catching\" aria-label=\"catching permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Catching</h2>\n<p>The first optimisation is the ugly closure in <code class=\"language-text\">loadDate</code>. It creates a <code class=\"language-text\">Result</code> that is returned immediately, and the string parameter is only used once.</p>\n<p>This pattern is usually easy to identify. We must be able to turn any throwing function into a function that returns a <code class=\"language-text\">Result</code> right? Indeed, that higher-order function can be seen below.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> catching<span class=\"token operator\">&lt;</span>A<span class=\"token punctuation\">,</span> B<span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> f<span class=\"token punctuation\">:</span> @escaping <span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> B<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token punctuation\">(</span>A<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">{</span> a <span class=\"token keyword\">in</span>\n        <span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span>B<span class=\"token operator\">></span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">try</span> <span class=\"token function\">f</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>With this function, we can turn any throwing function that takes in a parameter to a function that returns Result and not throws. For functions with more parameters, we have to implement a different <code class=\"language-text\">catching</code> function for them.</p>\n<p>Let’s use it in <code class=\"language-text\">loadDate</code>.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadString <span class=\"token punctuation\">{</span> stringResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> dateResult <span class=\"token operator\">=</span> stringResult<span class=\"token punctuation\">.</span>flatMap <span class=\"token punctuation\">{</span> string <span class=\"token keyword\">in</span>\n            <span class=\"token function\">catching</span><span class=\"token punctuation\">(</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>string<span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>dateResult<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Great! By using <code class=\"language-text\">catching</code> we have eliminated the need for using <code class=\"language-text\">try</code>, but it can be more concise since <code class=\"language-text\">string</code> is only used as the argument to the final function call.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadDate</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Date</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadString <span class=\"token punctuation\">{</span> stringResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> dateResult <span class=\"token operator\">=</span> stringResult<span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token function\">catching</span><span class=\"token punctuation\">(</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>dateResult<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This is some very clean code. To make it more readable, one can assign a function to variables and pass it around.</p>\n<h2 id=\"get\" style=\"position:relative;\"><a href=\"#get\" aria-label=\"get permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Get</h2>\n<p>However, it’s still useful to quickly get back to the throwing world. So we will create a method on <code class=\"language-text\">Result</code> that quickly lets us bridge the two worlds.</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">extension</span> <span class=\"token builtin\">Result</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">func</span> <span class=\"token keyword\">get</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> A <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">switch</span> <span class=\"token keyword\">self</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">success</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">return</span> value\n            <span class=\"token keyword\">case</span> <span class=\"token punctuation\">.</span><span class=\"token function\">failure</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> e<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span>\n                <span class=\"token keyword\">throw</span> e\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"multiple-operations\" style=\"position:relative;\"><a href=\"#multiple-operations\" aria-label=\"multiple operations permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Multiple Operations</h2>\n<p>To be frank, it’s not practical to create an intermediate method for every new function call right? We probably don’t need loadDate, loadMonth etc. In fact, it’s entirely possible that we only care about <code class=\"language-text\">loadNumberOfDays</code>. So, just chain’em all!</p>\n<div class=\"gatsby-highlight\" data-language=\"swift\"><pre class=\"language-swift\"><code class=\"language-swift\"><span class=\"token keyword\">func</span> <span class=\"token function\">loadNumberOfDaysCombined</span><span class=\"token punctuation\">(</span><span class=\"token number\">_</span> callback<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">(</span><span class=\"token builtin\">Result</span><span class=\"token operator\">&lt;</span><span class=\"token builtin\">Int</span><span class=\"token operator\">></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span><span class=\"token operator\">></span> <span class=\"token builtin\">Void</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    loadString <span class=\"token punctuation\">{</span> stringResult <span class=\"token keyword\">in</span>\n        <span class=\"token keyword\">let</span> daysResult <span class=\"token operator\">=</span> stringResult<span class=\"token punctuation\">.</span><span class=\"token function\">flatMap</span><span class=\"token punctuation\">(</span><span class=\"token function\">catching</span><span class=\"token punctuation\">(</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span>from<span class=\"token punctuation\">:</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">map</span><span class=\"token punctuation\">(</span><span class=\"token function\">getMonth</span><span class=\"token punctuation\">(</span>of<span class=\"token punctuation\">:</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token builtin\">map</span> <span class=\"token punctuation\">{</span> $<span class=\"token number\">0</span><span class=\"token punctuation\">.</span><span class=\"token function\">numberOfDays</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">}</span>\n\n        <span class=\"token function\">callback</span><span class=\"token punctuation\">(</span>daysResult<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>It’s very short – and remember, we have not given up any error handling abilities. Any errors would still be propagated to the callback closure correctly, as it should be.</p>\n<h2 id=\"conclusion\" style=\"position:relative;\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Now that we have learned to implement these functions on Result, we can start utilising its potentials. Hopefully, you have started to feel like Array and Result are more alike than they initially appeared to be. Just throwing it as a curveball, have you ever thought of Optional (the infamous “?”) in a similar fashion? And do you also know map exists on Optional?</p>\n<p>Although you might not realize, but you have subconsciously learned the fundamental concepts of a ‘container’. As a matter of fact, it’s not a new thing. An array is a container, an Optional is a container, a Dictionary is also a container. These containers are easy to grasp because they all have some kind of instance property holding on to certain objects.</p>\n<p>So it gets really weird when we implement Future/Promise who don’t necessarily hold onto a value but just promise to deliver it when the time comes. But that’s for another day. Please let me know if you have any comments, questions, or feedback. Thank you😊</p>","frontmatter":{"title":"(RE)Designing Objective-C APIs in Swift","date":"26/02/2021","showToc":true}}},"pageContext":{"slug":"/API/(RE)Designing-Objective-C-APIs-in-Swift/","previous":null,"next":{"fields":{"slug":"/machine-learning/Making-Core-Data-Functional/"},"frontmatter":{"title":"Making Core Data Functional","category":"iOS","draft":false,"showToc":true}}}},"staticQueryHashes":["3128451518","4154702432"]}